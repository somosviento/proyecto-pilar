# Configuración de Apache Virtual Host para Proyecto Pilar
# Copiar esta configuración al archivo de configuración de Apache
# (por ejemplo: /etc/apache2/sites-available/proyecto-pilar.conf)

<VirtualHost *:80>
    # Configuración básica del servidor
    ServerName tu-dominio.com
    ServerAlias www.tu-dominio.com
    DocumentRoot /ruta/al/proyecto/pilar2
    
    # Configuración WSGI
    WSGIDaemonProcess pilar python-home=/ruta/al/proyecto/pilar2/.venv python-path=/ruta/al/proyecto/pilar2
    WSGIProcessGroup pilar
    WSGIScriptAlias /proyecto-pilar /ruta/al/proyecto/pilar2/wsgi.py
    
    # Configuración de directorios
    <Directory /ruta/al/proyecto/pilar2>
        WSGIApplicationGroup %{GLOBAL}
        Require all granted
    </Directory>
    
    # Archivos estáticos - servir directamente desde Apache
    Alias /proyecto-pilar/static /ruta/al/proyecto/pilar2/static
    <Directory /ruta/al/proyecto/pilar2/static>
        Require all granted
        # Configurar headers de cache para archivos estáticos
        <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg)$">
            ExpiresActive On
            ExpiresDefault "access plus 1 month"
            Header append Cache-Control "public"
        </FilesMatch>
    </Directory>
    
    # Configuración de logs
    ErrorLog ${APACHE_LOG_DIR}/pilar_error.log
    CustomLog ${APACHE_LOG_DIR}/pilar_access.log combined
    LogLevel info
    
    # Configuración de seguridad
    <Directory /ruta/al/proyecto/pilar2>
        # Denegar acceso a archivos sensibles
        <Files "*.pyc">
            Require all denied
        </Files>
        <Files "*.pyo">
            Require all denied
        </Files>
        <Files ".env">
            Require all denied
        </Files>
        <Files "*.db">
            Require all denied
        </Files>
    </Directory>
    
    # Headers de seguridad
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://code.jquery.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com https://cdn.jsdelivr.net; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net; img-src 'self' data:; connect-src 'self';"
</VirtualHost>

# Si usas HTTPS (recomendado para producción):
<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerName tu-dominio.com
    ServerAlias www.tu-dominio.com
    DocumentRoot /ruta/al/proyecto/pilar2
    
    # Configuración SSL
    SSLEngine on
    SSLCertificateFile /ruta/al/certificado.crt
    SSLCertificateKeyFile /ruta/al/clave-privada.key
    # SSLCertificateChainFile /ruta/al/chain.crt  # Si usas certificado intermedio
    
    # Resto de configuración igual que HTTP
    WSGIDaemonProcess pilar-ssl python-home=/ruta/al/proyecto/pilar2/.venv python-path=/ruta/al/proyecto/pilar2
    WSGIProcessGroup pilar-ssl
    WSGIScriptAlias /proyecto-pilar /ruta/al/proyecto/pilar2/wsgi.py
    
    <Directory /ruta/al/proyecto/pilar2>
        WSGIApplicationGroup %{GLOBAL}
        Require all granted
    </Directory>
    
    Alias /proyecto-pilar/static /ruta/al/proyecto/pilar2/static
    <Directory /ruta/al/proyecto/pilar2/static>
        Require all granted
        <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg)$">
            ExpiresActive On
            ExpiresDefault "access plus 1 month"
            Header append Cache-Control "public"
        </FilesMatch>
    </Directory>
    
    ErrorLog ${APACHE_LOG_DIR}/pilar_ssl_error.log
    CustomLog ${APACHE_LOG_DIR}/pilar_ssl_access.log combined
    
    # Headers de seguridad (más estrictos para HTTPS)
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://code.jquery.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com https://cdn.jsdelivr.net; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net; img-src 'self' data:; connect-src 'self';"
</VirtualHost>
</IfModule>